<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.samgyeobsal.mapper.FundingMapper">

    <select id="getFundingList" resultType="com.samgyeobsal.domain.funding.FundingVO">
        select fstore_name,
               ftitle,
               nvl(totalprice,0) totalprice,
               fimg1, trunc(cfunding_end_date-sysdate,0) expire  from funding f
                                                                          left join (select f.fid,sum(oitotalprice) totalprice
                                                                                     from order_item oi
                                                                                              join product_option po on oi.poid=po.poid
                                                                                              join funding_product fp on po.fpid=fp.fpid
                                                                                              join funding f on f.fid=fp.fid
                                                                                     group by f.fid) total on total.fid= f.fid
                                                                          join competition c on c.cid=f.cid
        where fstatus = 'funding' and sysdate between cfunding_start_date and cfunding_end_date
        <choose>
            <when test="criteria.type =='1'.toString()">
                and ctid='1'
            </when>
            <when test="criteria.type =='2'.toString()">
                and ctid='2'
            </when>
            <when test="criteria.type =='3'.toString()">
                and  ctid='3'
            </when>
            <when test="criteria.type =='4'.toString()">
                and  ctid='4'
            </when>
            <when test="criteria.type =='5'.toString()">
                and ctid='5'
            </when>
            <when test="criteria.type =='6'.toString()">
                and ctid='6'
            </when>
            <when test="criteria.type =='7'.toString()">
                and ctid='7'
            </when>
            <otherwise>
            </otherwise>
        </choose>
        order by fdate
    </select>

</mapper>